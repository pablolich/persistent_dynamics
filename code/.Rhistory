}
# Output PDF name (one file per combo)
out_pdf <- file.path(
dir,
sprintf("glv_%s_%s_%s.pdf", ty, st, ph)
)
pdf(out_pdf, width = 11, height = 11, onefile = TRUE)
# Chunk into groups of up to 25
n_files <- length(subset_files)
chunks  <- split(
subset_files,
ceiling(seq_along(subset_files) / 25)
)
for (chunk_idx in seq_along(chunks)) {
chunk_files <- chunks[[chunk_idx]]
grobs <- lapply(chunk_files, function(f) {
sim_df <- simulate_glv_file(f, t_max = t_max, dt = dt)
attempt_id <- parse_attempt_from_filename(f)
title <- if (!is.na(attempt_id)) {
paste("attempt", attempt_id)
} else {
basename(f)
}
plot_glv_panel(sim_df, title = title)
})
# If fewer than 25 grobs, grid.arrange still works; some cells empty
gridExtra::grid.arrange(
grobs = grobs,
nrow  = 5,
ncol  = 5,
top   = sprintf("%s / %s / %s  (page %d)",
ty, st, ph, chunk_idx)
)
}
dev.off()
}
}
}
}
plot_all_combinations("results/normal_f32/mu=0.0_sigma=2.0_rho=0.0/",
t_max = 50, dt = 0.1)
library(deSolve)
library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(tools)
# ------------------------------------------------------------
# Load A and r from one file: first column is attempt, then A, then r
# ------------------------------------------------------------
load_glv_params <- function(path) {
M <- as.matrix(read.table(path, header = FALSE))
n <- nrow(M)
stopifnot(ncol(M) == n + 2)  # [attempt | A (n cols) | r]
A <- M[, 2:(n + 1), drop = FALSE]
r <- M[, n + 2]
list(A = A, r = r)
}
# ------------------------------------------------------------
# GLV RHS: dx/dt = x * (r + A x)
# ------------------------------------------------------------
glv_rhs <- function(t, x, parms) {
A <- parms$A
r <- parms$r
dx <- x * (r + as.vector(A %*% x))
list(dx)
}
# ------------------------------------------------------------
# Integrate GLV for a given file
# ------------------------------------------------------------
simulate_glv_file <- function(path, x0 = NULL, t_max = 50, dt = 0.1) {
pars <- load_glv_params(path)
n <- length(pars$r)
if (is.null(x0)) x0 <- rep(1, n)
times <- seq(0, t_max, by = dt)
out <- ode(y = x0, times = times, func = glv_rhs, parms = pars)
df  <- as.data.frame(out)
colnames(df)[-1] <- paste0("x", seq_len(n))
df
}
# ------------------------------------------------------------
# Small panel plot for one system
# ------------------------------------------------------------
plot_glv_panel <- function(sim_df, title = NULL) {
sim_df %>%
pivot_longer(-time, names_to = "species", values_to = "x") %>%
ggplot(aes(time, x, colour = species)) +
geom_line(linewidth = 0.3) +
labs(x = NULL, y = NULL, title = title) +
theme_bw(base_size = 8) +
theme(
legend.position = "none",
plot.title = element_text(size = 8, hjust = 0.5),
axis.text  = element_text(size = 6)
)
}
# ------------------------------------------------------------
# Parse type/stability/physicality from filename
# ------------------------------------------------------------
# Expect last 3 tokens (before .txt) to be:
# physical|unphysical, strong|weak, stable|unstable
parse_labels_from_filename <- function(path) {
stem   <- tools::file_path_sans_ext(basename(path))
tokens <- strsplit(stem, "_", fixed = TRUE)[[1]]
phys      <- tokens[length(tokens) - 2]   # "physical" or "unphysical"
type      <- tokens[length(tokens) - 1]   # "strong" or "weak"
stability <- tokens[length(tokens)]       # "stable" or "unstable"
list(type = type, stability = stability, phys = phys)
}
# Optionally: parse attempt number for panel titles
parse_attempt_from_filename <- function(path) {
stem <- file_path_sans_ext(basename(path))
tokens <- strsplit(stem, "_", fixed = TRUE)[[1]]
attempt_token <- tokens[grep("^attempt", tokens)]
if (length(attempt_token) == 1L) {
as.integer(sub("attempt", "", attempt_token))
} else {
NA_integer_
}
}
# ------------------------------------------------------------
# Main function: for each (type, stability, phys) combination,
# create a PDF with multi-page 5x5 grids (25 plots per page).
# ------------------------------------------------------------
plot_all_combinations <- function(
dir = "results/normal_f32/mu=0_sigma=2_n=10/",
t_max = 50,
dt = 0.1
) {
files <- list.files(dir, pattern = "\\.txt$", full.names = TRUE)
if (length(files) == 0L) {
stop("No .txt files found in directory: ", dir)
}
# Build a data frame of metadata
meta <- lapply(files, function(f) {
lab <- parse_labels_from_filename(f)
data.frame(
file      = f,
type      = lab$type,
stability = lab$stability,
phys      = lab$phys,
stringsAsFactors = FALSE
)
}) %>%
bind_rows()
# All 2x2x2 combinations we care about
types      <- c("strong", "weak")
stabilities <- c("stable", "unstable")
phys_vals  <- c("physical", "unphysical")
for (ph in phys_vals) {
for (ty in types) {
for (st in stabilities) {
subset_files <- meta %>%
filter(type == ty, stability == st, phys == ph) %>%
pull(file)
if (length(subset_files) == 0L) {
next
}
# Output PDF name (one file per combo)
out_pdf <- file.path(
dir,
sprintf("glv_%s_%s_%s.pdf", ph, ty, st)
)
pdf(out_pdf, width = 11, height = 11, onefile = TRUE)
# Chunk into groups of up to 25
n_files <- length(subset_files)
chunks  <- split(
subset_files,
ceiling(seq_along(subset_files) / 25)
)
for (chunk_idx in seq_along(chunks)) {
chunk_files <- chunks[[chunk_idx]]
grobs <- lapply(chunk_files, function(f) {
sim_df <- simulate_glv_file(f, t_max = t_max, dt = dt)
attempt_id <- parse_attempt_from_filename(f)
title <- if (!is.na(attempt_id)) {
paste("attempt", attempt_id)
} else {
basename(f)
}
plot_glv_panel(sim_df, title = title)
})
# If fewer than 25 grobs, grid.arrange still works; some cells empty
gridExtra::grid.arrange(
grobs = grobs,
nrow  = 5,
ncol  = 5,
top   = sprintf("%s / %s / %s  (page %d)",
ty, st, ph, chunk_idx)
)
}
dev.off()
}
}
}
}
plot_all_combinations("results/normal_f32/mu=0.0_sigma=2.0_rho=0.0/",
t_max = 50, dt = 0.1)
library(deSolve)
library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(tools)
# ------------------------------------------------------------
# Load A and r from one file: first column is attempt, then A, then r
# ------------------------------------------------------------
load_glv_params <- function(path) {
M <- as.matrix(read.table(path, header = FALSE))
n <- nrow(M)
stopifnot(ncol(M) == n + 2)  # [attempt | A (n cols) | r]
A <- M[, 2:(n + 1), drop = FALSE]
r <- M[, n + 2]
list(A = A, r = r)
}
# ------------------------------------------------------------
# GLV RHS: dx/dt = x * (r + A x)
# ------------------------------------------------------------
glv_rhs <- function(t, x, parms) {
A <- parms$A
r <- parms$r
dx <- x * (r + as.vector(A %*% x))
list(dx)
}
# ------------------------------------------------------------
# Integrate GLV for a given file
# ------------------------------------------------------------
simulate_glv_file <- function(path, x0 = NULL, t_max = 50, dt = 0.1) {
pars <- load_glv_params(path)
n <- length(pars$r)
if (is.null(x0)) x0 <- rep(1, n)
times <- seq(0, t_max, by = dt)
out <- ode(y = x0, times = times, func = glv_rhs, parms = pars)
df  <- as.data.frame(out)
colnames(df)[-1] <- paste0("x", seq_len(n))
df
}
# ------------------------------------------------------------
# Small panel plot for one system
# ------------------------------------------------------------
plot_glv_panel <- function(sim_df, title = NULL) {
sim_df %>%
pivot_longer(-time, names_to = "species", values_to = "x") %>%
ggplot(aes(time, x, colour = species)) +
geom_line(linewidth = 0.3) +
labs(x = NULL, y = NULL, title = title) +
theme_bw(base_size = 8) +
theme(
legend.position = "none",
plot.title = element_text(size = 8, hjust = 0.5),
axis.text  = element_text(size = 6)
)
}
# ------------------------------------------------------------
# Parse type/stability/physicality from filename
# ------------------------------------------------------------
# Expect last 3 tokens (before .txt) to be:
# physical|unphysical, strong|weak, stable|unstable
parse_labels_from_filename <- function(path) {
stem   <- tools::file_path_sans_ext(basename(path))
tokens <- strsplit(stem, "_", fixed = TRUE)[[1]]
phys      <- tokens[length(tokens) - 2]   # "physical" or "unphysical"
type      <- tokens[length(tokens) - 1]   # "strong" or "weak"
stability <- tokens[length(tokens)]       # "stable" or "unstable"
list(type = type, stability = stability, phys = phys)
}
# Optionally: parse attempt number for panel titles
parse_attempt_from_filename <- function(path) {
stem <- file_path_sans_ext(basename(path))
tokens <- strsplit(stem, "_", fixed = TRUE)[[1]]
attempt_token <- tokens[grep("^attempt", tokens)]
if (length(attempt_token) == 1L) {
as.integer(sub("attempt", "", attempt_token))
} else {
NA_integer_
}
}
# ------------------------------------------------------------
# Main function: for each (type, stability, phys) combination,
# create a PDF with multi-page 5x5 grids (25 plots per page).
# ------------------------------------------------------------
plot_all_combinations <- function(
dir = "results/normal_f32/mu=0_sigma=2_n=10/",
t_max = 50,
dt = 0.1
) {
files <- list.files(dir, pattern = "\\.txt$", full.names = TRUE)
if (length(files) == 0L) {
stop("No .txt files found in directory: ", dir)
}
# Build a data frame of metadata
meta <- lapply(files, function(f) {
lab <- parse_labels_from_filename(f)
data.frame(
file      = f,
type      = lab$type,
stability = lab$stability,
phys      = lab$phys,
stringsAsFactors = FALSE
)
}) %>%
bind_rows()
# All 2x2x2 combinations we care about
types      <- c("strong", "weak")
stabilities <- c("stable", "unstable")
phys_vals  <- c("physical", "unphysical")
for (ph in phys_vals) {
for (ty in types) {
for (st in stabilities) {
subset_files <- meta %>%
filter(type == ty, stability == st, phys == ph) %>%
pull(file)
if (length(subset_files) == 0L) {
next
}
# Output PDF name (one file per combo)
out_pdf <- file.path(
dir,
sprintf("glv_%s_%s_%s.pdf", ph, ty, st)
)
pdf(out_pdf, width = 11, height = 11, onefile = TRUE)
# Chunk into groups of up to 25
n_files <- length(subset_files)
chunks  <- split(
subset_files,
ceiling(seq_along(subset_files) / 25)
)
for (chunk_idx in seq_along(chunks)) {
chunk_files <- chunks[[chunk_idx]]
grobs <- lapply(chunk_files, function(f) {
sim_df <- simulate_glv_file(f, t_max = t_max, dt = dt)
attempt_id <- parse_attempt_from_filename(f)
title <- if (!is.na(attempt_id)) {
paste("attempt", attempt_id)
} else {
basename(f)
}
plot_glv_panel(sim_df, title = title)
})
# If fewer than 25 grobs, grid.arrange still works; some cells empty
gridExtra::grid.arrange(
grobs = grobs,
nrow  = 5,
ncol  = 5,
top   = sprintf("%s / %s / %s  (page %d)",
ty, st, ph, chunk_idx)
)
}
dev.off()
}
}
}
}
plot_all_combinations("results/normal_f32/mu=0.0_sigma=2.0_rho=0.0/",
t_max = 500, dt = 1)
library(deSolve)
library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)
library(tools)
# ------------------------------------------------------------
# Load A and r from one file: first column is attempt, then A, then r
# ------------------------------------------------------------
load_glv_params <- function(path) {
M <- as.matrix(read.table(path, header = FALSE))
n <- nrow(M)
stopifnot(ncol(M) == n + 2)  # [attempt | A (n cols) | r]
A <- M[, 2:(n + 1), drop = FALSE]
r <- M[, n + 2]
list(A = A, r = r)
}
# ------------------------------------------------------------
# GLV RHS: dx/dt = x * (r + A x)
# ------------------------------------------------------------
glv_rhs <- function(t, x, parms) {
A <- parms$A
r <- parms$r
dx <- x * (r + as.vector(A %*% x))
list(dx)
}
# ------------------------------------------------------------
# Integrate GLV for a given file
# ------------------------------------------------------------
simulate_glv_file <- function(path, x0 = NULL, t_max = 50, dt = 0.1) {
pars <- load_glv_params(path)
n <- length(pars$r)
if (is.null(x0)) x0 <- rep(1, n)
times <- seq(0, t_max, by = dt)
out <- ode(y = x0, times = times, func = glv_rhs, parms = pars, method = "ode45")
df  <- as.data.frame(out)
colnames(df)[-1] <- paste0("x", seq_len(n))
df
}
# ------------------------------------------------------------
# Small panel plot for one system
# ------------------------------------------------------------
plot_glv_panel <- function(sim_df, title = NULL) {
sim_df %>%
pivot_longer(-time, names_to = "species", values_to = "x") %>%
ggplot(aes(time, x, colour = species)) +
geom_line(linewidth = 0.3) +
labs(x = NULL, y = NULL, title = title) +
theme_bw(base_size = 8) +
theme(
legend.position = "none",
plot.title = element_text(size = 8, hjust = 0.5),
axis.text  = element_text(size = 6)
)
}
# ------------------------------------------------------------
# Parse type/stability/physicality from filename
# ------------------------------------------------------------
# Expect last 3 tokens (before .txt) to be:
# physical|unphysical, strong|weak, stable|unstable
parse_labels_from_filename <- function(path) {
stem   <- tools::file_path_sans_ext(basename(path))
tokens <- strsplit(stem, "_", fixed = TRUE)[[1]]
phys      <- tokens[length(tokens) - 2]   # "physical" or "unphysical"
type      <- tokens[length(tokens) - 1]   # "strong" or "weak"
stability <- tokens[length(tokens)]       # "stable" or "unstable"
list(type = type, stability = stability, phys = phys)
}
# Optionally: parse attempt number for panel titles
parse_attempt_from_filename <- function(path) {
stem <- file_path_sans_ext(basename(path))
tokens <- strsplit(stem, "_", fixed = TRUE)[[1]]
attempt_token <- tokens[grep("^attempt", tokens)]
if (length(attempt_token) == 1L) {
as.integer(sub("attempt", "", attempt_token))
} else {
NA_integer_
}
}
# ------------------------------------------------------------
# Main function: for each (type, stability, phys) combination,
# create a PDF with multi-page 5x5 grids (25 plots per page).
# ------------------------------------------------------------
plot_all_combinations <- function(
dir = "results/normal_f32/mu=0_sigma=2_n=10/",
t_max = 50,
dt = 0.1
) {
files <- list.files(dir, pattern = "\\.txt$", full.names = TRUE)
if (length(files) == 0L) {
stop("No .txt files found in directory: ", dir)
}
# Build a data frame of metadata
meta <- lapply(files, function(f) {
lab <- parse_labels_from_filename(f)
data.frame(
file      = f,
type      = lab$type,
stability = lab$stability,
phys      = lab$phys,
stringsAsFactors = FALSE
)
}) %>%
bind_rows()
# All 2x2x2 combinations we care about
types      <- c("strong", "weak")
stabilities <- c("stable", "unstable")
phys_vals  <- c("physical", "unphysical")
for (ph in phys_vals) {
for (ty in types) {
for (st in stabilities) {
subset_files <- meta %>%
filter(type == ty, stability == st, phys == ph) %>%
pull(file)
if (length(subset_files) == 0L) {
next
}
# Output PDF name (one file per combo)
out_pdf <- file.path(
dir,
sprintf("glv_%s_%s_%s.pdf", ph, ty, st)
)
pdf(out_pdf, width = 11, height = 11, onefile = TRUE)
# Chunk into groups of up to 25
n_files <- length(subset_files)
chunks  <- split(
subset_files,
ceiling(seq_along(subset_files) / 25)
)
for (chunk_idx in seq_along(chunks)) {
chunk_files <- chunks[[chunk_idx]]
grobs <- lapply(chunk_files, function(f) {
sim_df <- simulate_glv_file(f, t_max = t_max, dt = dt)
attempt_id <- parse_attempt_from_filename(f)
title <- if (!is.na(attempt_id)) {
paste("attempt", attempt_id)
} else {
basename(f)
}
plot_glv_panel(sim_df, title = title)
})
# If fewer than 25 grobs, grid.arrange still works; some cells empty
gridExtra::grid.arrange(
grobs = grobs,
nrow  = 5,
ncol  = 5,
top   = sprintf("%s / %s / %s  (page %d)",
ty, st, ph, chunk_idx)
)
}
dev.off()
}
}
}
}
plot_all_combinations("results/normal_f32/mu=0.0_sigma=3.5_rho=0.0/",
t_max = 500, dt = 1)
